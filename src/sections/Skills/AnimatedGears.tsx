import { useRef, forwardRef } from 'react';
import { gsap } from 'gsap';
import { useGSAP } from '@gsap/react';

const AnimatedGears = forwardRef<HTMLDivElement>((_, ref) => {
  const gear1Ref = useRef<SVGGElement>(null);
  const gear2Ref = useRef<SVGGElement>(null);
  const gear3Ref = useRef<SVGGElement>(null);

  useGSAP(() => {
    if (!gear1Ref.current || !gear2Ref.current || !gear3Ref.current) return;

    const triggerEl = ref && typeof ref === 'object' && 'current' in ref ? ref.current : document.body;

    gsap.to(gear1Ref.current, {
      rotation: 675,
      transformOrigin: 'center center',
      ease: 'none',
      scrollTrigger: {
        trigger: triggerEl,
        start: 'top',
        end: 'bottom top-=3000',
        scrub: 1,
      },
    });

    gsap.to(gear2Ref.current, {
      rotation: -720,
      transformOrigin: 'center center',
      ease: 'none',
      scrollTrigger: {
        trigger: triggerEl,
        start: 'top bottom',
        end: 'bottom top-=3000',
        scrub: 1,
      },
    });

    gsap.to(gear3Ref.current, {
      rotation: 720,
      transformOrigin: 'center center',
      ease: 'none',
      scrollTrigger: {
        trigger: triggerEl,
        start: 'top bottom',
        end: 'bottom top-=3000',
        scrub: 1,
      },
    });
  }, [ref]);

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      className="gears"
      viewBox="0 0 100 100"
      preserveAspectRatio="xMidYMid"
      width="600"
      height="600"
    >
      <g data-idx="1">
        <g transform="matrix(1,0,0,1,50,50)" data-idx="2">
          <g ref={gear1Ref} transform="matrix(0.5,0,0,0.5,-17,-17)" data-idx="3">
            <g
              data-idx="4"
              transform="matrix(0.9354423669649081,0.35347924703876216,-0.35347924703876216,0.9354423669649081,0,0)"
            >
              <path
                fill="#fff"
                d="M37.3496987939662 -7 L47.3496987939662 -7 L47.3496987939662 7 L37.3496987939662 7 A38 38 0 0 1 31.35997276079435 21.46047782418268 L31.35997276079435 21.46047782418268 L38.431040572659825 28.531545636048154 L28.531545636048154 38.431040572659825 L21.46047782418268 31.359972760794346 A38 38 0 0 1 7.0000000000000036 37.3496987939662 L7.0000000000000036 37.3496987939662 L7.000000000000004 47.3496987939662 L-6.999999999999999 47.3496987939662 L-7 37.3496987939662 A38 38 0 0 1 -21.46047782418268 31.35997276079435 L-21.46047782418268 31.35997276079435 L-28.531545636048154 38.431040572659825 L-38.43104057265982 28.531545636048158 L-31.359972760794346 21.460477824182682 A38 38 0 0 1 -37.3496987939662 7.000000000000007 L-37.3496987939662 7.000000000000007 L-47.3496987939662 7.000000000000008 L-47.3496987939662 -6.9999999999999964 L-37.3496987939662 -6.999999999999997 A38 38 0 0 1 -31.35997276079435 -21.460477824182675 L-31.35997276079435 -21.460477824182675 L-38.431040572659825 -28.531545636048147 L-28.53154563604818 -38.4310405726598 L-21.4604778241827 -31.35997276079433 A38 38 0 0 1 -6.999999999999992 -37.3496987939662 L-6.999999999999992 -37.3496987939662 L-6.999999999999994 -47.3496987939662 L6.999999999999977 -47.3496987939662 L6.999999999999979 -37.3496987939662 A38 38 0 0 1 21.460477824182686 -31.359972760794342 L21.460477824182686 -31.359972760794342 L28.531545636048158 -38.43104057265982 L38.4310405726598 -28.53154563604818 L31.35997276079433 -21.4604778241827 A38 38 0 0 1 37.3496987939662 -6.999999999999995 M0 -20A20 20 0 1 0 0 20 A20 20 0 1 0 0 -20"
                data-idx="6"
              />
            </g>
          </g>

          <g ref={gear2Ref} transform="matrix(0.4000000059604645,0,0,0.4000000059604645,0,22)" data-idx="7">
            <g
              data-idx="8"
              transform="matrix(0.9995067092549036,0.03140602099014948,-0.03140602099014948,0.9995067092549036,0,0)"
            >
              <path
                fill="#fff"
                d="M37.3496987939662 -7 L47.3496987939662 -7 L47.3496987939662 7 L37.3496987939662 7 A38 38 0 0 1 31.35997276079435 21.46047782418268 L31.35997276079435 21.46047782418268 L38.431040572659825 28.531545636048154 L28.531545636048154 38.431040572659825 L21.46047782418268 31.359972760794346 A38 38 0 0 1 7.0000000000000036 37.3496987939662 L7.0000000000000036 37.3496987939662 L7.000000000000004 47.3496987939662 L-6.999999999999999 47.3496987939662 L-7 37.3496987939662 A38 38 0 0 1 -21.46047782418268 31.35997276079435 L-21.46047782418268 31.35997276079435 L-28.531545636048154 38.431040572659825 L-38.43104057265982 28.531545636048158 L-31.359972760794346 21.460477824182682 A38 38 0 0 1 -37.3496987939662 7.000000000000007 L-37.3496987939662 7.000000000000007 L-47.3496987939662 7.000000000000008 L-47.3496987939662 -6.9999999999999964 L-37.3496987939662 -6.999999999999997 A38 38 0 0 1 -31.35997276079435 -21.460477824182675 L-31.35997276079435 -21.460477824182675 L-38.431040572659825 -28.531545636048147 L-28.53154563604818 -38.4310405726598 L-21.4604778241827 -31.35997276079433 A38 38 0 0 1 -6.999999999999992 -37.3496987939662 L-6.999999999999992 -37.3496987939662 L-6.999999999999994 -47.3496987939662 L6.999999999999977 -47.3496987939662 L6.999999999999979 -37.3496987939662 A38 38 0 0 1 21.460477824182686 -31.359972760794342 L21.460477824182686 -31.359972760794342 L28.531545636048158 -38.43104057265982 L38.4310405726598 -28.53154563604818 L31.35997276079433 -21.4604778241827 A38 38 0 0 1 37.3496987939662 -6.999999999999995 M0 -20A20 20 0 1 0 0 20 A20 20 0 1 0 0 -20"
                data-idx="10"
              />
            </g>
          </g>

          <g ref={gear3Ref} transform="matrix(0.30000001192092896,0,0,0.30000001192092896,28,4)" data-idx="11">
            <g
              data-idx="12"
              transform="matrix(0.728965382367815,0.6845505615433715,-0.6845505615433715,0.728965382367815,0,0)"
            >
              <path
                fill="#fff"
                d="M37.3496987939662 -7 L47.3496987939662 -7 L47.3496987939662 7 L37.3496987939662 7 A38 38 0 0 1 31.35997276079435 21.46047782418268 L31.35997276079435 21.46047782418268 L38.431040572659825 28.531545636048154 L28.531545636048154 38.431040572659825 L21.46047782418268 31.359972760794346 A38 38 0 0 1 7.0000000000000036 37.3496987939662 L7.0000000000000036 37.3496987939662 L7.000000000000004 47.3496987939662 L-6.999999999999999 47.3496987939662 L-7 37.3496987939662 A38 38 0 0 1 -21.46047782418268 31.35997276079435 L-21.46047782418268 31.35997276079435 L-28.531545636048154 38.431040572659825 L-38.43104057265982 28.531545636048158 L-31.359972760794346 21.460477824182682 A38 38 0 0 1 -37.3496987939662 7.000000000000007 L-37.3496987939662 7.000000000000007 L-47.3496987939662 7.000000000000008 L-47.3496987939662 -6.9999999999999964 L-37.3496987939662 -6.999999999999997 A38 38 0 0 1 -31.35997276079435 -21.460477824182675 L-31.35997276079435 -21.460477824182675 L-38.431040572659825 -28.531545636048147 L-28.53154563604818 -38.4310405726598 L-21.4604778241827 -31.35997276079433 A38 38 0 0 1 -6.999999999999992 -37.3496987939662 L-6.999999999999992 -37.3496987939662 L-6.999999999999994 -47.3496987939662 L6.999999999999977 -47.3496987939662 L6.999999999999979 -37.3496987939662 A38 38 0 0 1 21.460477824182686 -31.359972760794342 L21.460477824182686 -31.359972760794342 L28.531545636048158 -38.43104057265982 L38.4310405726598 -28.53154563604818 L31.35997276079433 -21.4604778241827 A38 38 0 0 1 37.3496987939662 -6.999999999999995 M0 -20A20 20 0 1 0 0 20 A20 20 0 1 0 0 -20"
                data-idx="14"
              />
            </g>
          </g>
        </g>
      </g>
    </svg>
  );
});

AnimatedGears.displayName = 'AnimatedGears';

export default AnimatedGears;
